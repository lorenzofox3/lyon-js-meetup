<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Build a user interface with Javascript coroutines</title><link rel="stylesheet" type="text/css" href="style/prism-tomorrow.css"><link rel="stylesheet" type="text/css" href="style/theme.css"><link rel="stylesheet" type="text/css" href="style/traffic-light.css"><script type="module" async src="js/index.js"></script><script type="module" async src="js/traffic-light-demo.js"></script><script type="module" async src="js/demo-basic.js"></script><script type="module" async src="js/redux-demo.js"></script></head><body><main class="scrollable" id="main"><section class="centered" id="definition"><h2 class="visually-hidden">Definition</h2><figure><blockquote class="centered" cite="https://en.wikipedia.org/wiki/Coroutine"><p class="centered">Coroutines are computer program components that generalize subroutines [...], by allowing execution to be suspended and resumed. Coroutines are well-suited for
implementing familiar program components such as cooperative tasks, exceptions, event loops,
iterators, infinite lists and pipes.</p></blockquote><figcaption>-Wikipedia</figcaption></figure></section><section is="app-story"><h2 id="generator-functions">Generator function</h2><div class="scrollable"><app-story-point step="initial"><p>Function declaration</p></app-story-point><app-story-point step="yield-expression"><p>yield expression</p></app-story-point><app-story-point step="yield-alone"><p>Single statement</p></app-story-point><app-story-point step="yield-assignation"><p>Assignation</p></app-story-point><app-story-point step="yield-both"><p>Bidirectional</p></app-story-point><app-story-point step="yield-delegation"><p>Delegation</p></app-story-point></div><div class="code-container"><pre><code class="language-javascript"><code-point step-initial="active" step-yield-expression="faded"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code-point><code-point step-initial="inline-hidden" step-yield-expression="active" step-yield-alone="faded"><div>  <span class="token keyword">yield</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span></div><div>  <span class="token keyword">yield</span> <span class="token string">'hello world'</span><span class="token punctuation">;</span></div></code-point><code-point step-initial="inline-hidden" step-yield-alone="active" step-yield-assignation="faded">  <span class="token keyword">yield</span><span class="token punctuation">;</span></code-point><code-point step-initial="inline-hidden" step-yield-assignation="active" step-yield-both="faded">  <span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token keyword">yield</span><span class="token punctuation">;</span></code-point><code-point step-initial="inline-hidden" step-yield-both="active" step-yield-delegation="faded">  <span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token string">'some value'</span><span class="token punctuation">;</span></code-point><code-point step-initial="inline-hidden" step-yield-delegation="active">  <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div><span class="token punctuation">}</span></div></code></pre></div></section><section is="app-story"><h2 id="iterable">Return type</h2><div class="scrollable"><app-story-point step="initial"><p>Return statement</p></app-story-point><app-story-point step="return-type"><p>Returns a Generator Object</p></app-story-point></div><div class="code-container"><pre><code class="language-javascript"><code-point step-initial="faded"><div><span class="token keyword">import</span> <span class="token punctuation">{</span> test <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'zora'</span><span class="token punctuation">;</span></div><br></code-point><code-point step-initial="" step-return-type="faded"><div><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span></div><div>  <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span></div><div>  <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span></div><code-point step-initial="active">  <span class="token keyword">return</span> <span class="token number">42</span><span class="token punctuation">;</span></code-point><div><span class="token punctuation">}</span></div></code-point><br><code-point step-initial="inline-hidden" step-return-type=""><div><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'generator function returns a GeneratorObject'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><code-point step-return-type="active">  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code-point></code></pre></div></section><section is="app-story"><h2 id="iterable">Generator Object: iterable</h2><div class="scrollable"><app-story-point step="initial"><p>implements the iterable protocol</p></app-story-point><app-story-point step="spread"><p>spread</p></app-story-point><app-story-point step="for-of"><p>for .. of loop</p></app-story-point><app-story-point step="generator-delegation"><p>generator delegation</p></app-story-point></div><div class="code-container"><pre><code class="language-javascript"><code-point step-initial="" step-spread="block-hidden"><div><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'generator object implements the @@iterator method'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><code-point step-initial="active">  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div>  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code-point><code-point step-initial="block-hidden" step-spread="" step-various-api="block-hidden"><code-point step-initial="" step-for-of="faded"><div><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'generator object can be spread'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><code-point step-initial="active" step-for-of="">  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code-point><code-point step-spread="inline-hidden" step-for-of="" step-generator-delegation="faded"><div><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'for .. of loop consumes a generator object'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">const</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><code-point step-for-of="active" step-generator-delegation="">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> el <span class="token keyword">of</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code-point><div>    values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  <span class="token punctuation">}</span></div><div>  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>values<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code-point><code-point step-spread="inline-hidden" step-generator-delegation=""><div><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'generator can delegate to a generator object'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>    <span class="token keyword">yield</span> <span class="token number">0</span><span class="token punctuation">;</span></div><code-point step-generator-delegation="active">    <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div>    <span class="token keyword">yield</span> <span class="token number">5</span><span class="token punctuation">;</span></div><div>  <span class="token punctuation">}</span></div><div>  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">around</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code-point></code-point></code></pre></div></section><section is="app-story"><h2 id="iterator">Generator Object: Iterator</h2><div class="scrollable"><app-story-point step="initial"><p>Implements the iterator protocol</p></app-story-point><app-story-point step="next"><p>Calling next returns an iterator result</p></app-story-point><app-story-point step="return"><p>Return is in the sequence</p></app-story-point><app-story-point step="exhausted"><p>Exhausted</p></app-story-point></div><div class="code-container"><pre><code class="language-javascript"><code-point step-initial="" step-next="block-hidden"><div><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'generator object implements the iterator protocol'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">const</span> iterableIterator <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><code-point step-initial="active">  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> iterableIterator<span class="token punctuation">.</span>next<span class="token punctuation">,</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div>  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> iterableIterator<span class="token punctuation">.</span>throw<span class="token punctuation">,</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> iterableIterator<span class="token punctuation">.</span>return<span class="token punctuation">,</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code-point><code-point step-initial="block-hidden" step-next=""><div><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'calling next returns an iterator result'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><code-point step-initial="" step-return="faded"><div>  <span class="token keyword">const</span> iterableIterator <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><code-point step-next="active" step-return="">  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>iterableIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div>  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>iterableIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>iterableIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code-point><code-point step-initial="inline-hidden" step-return="active" step-exhausted="faded">  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>iterableIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><code-point step-initial="inline-hidden" step-exhausted="active">  t<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>iterableIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code-point></code></pre></div></section><section is="app-story"><h2 id="state-machine">State machine</h2><div class="scrollable"><app-story-point step="initial"><p>Lazy evaluation and infinite loop</p></app-story-point><app-story-point step="alternative"><p>Or delegate to an ... iterable</p></app-story-point><app-story-point step="hide-protocol"><p>Generator is an implementation detail</p></app-story-point><app-story-point step="process"><p>Trigger and react to state change</p></app-story-point></div><div class="code-container"><pre><code class="language-javascript"><code-point step-initial="" step-alternative="block-hidden"><div><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">trafficLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><code-point step-initial="active">  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code-point><div>    <span class="token keyword">yield</span> <span class="token string">'green'</span><span class="token punctuation">;</span></div><div>    <span class="token keyword">yield</span> <span class="token string">'orange'</span><span class="token punctuation">;</span></div><div>    <span class="token keyword">yield</span> <span class="token string">'red'</span><span class="token punctuation">;</span></div><div>  <span class="token punctuation">}</span></div><div><span class="token punctuation">}</span></div></code-point><code-point step-initial="block-hidden" step-alternative="" step-process="block-hidden"><code-point step-initial="" step-hide-protocol="faded"><div><span class="token keyword">const</span> possibleStates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'orange'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">trafficLightBis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><code-point step-alternative="active" step-hide-protocol="">    <span class="token keyword">yield</span><span class="token operator">*</span> possibleStates<span class="token punctuation">;</span></code-point><div>  <span class="token punctuation">}</span></div><div><span class="token punctuation">}</span></div></code-point><br><code-point step-initial="inline-hidden" step-hide-protocol=""><div><span class="token keyword">const</span> <span class="token function-variable function">stateMachine</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">const</span> it <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><code-point step-hide-protocol="active">  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span></code-point><div><span class="token punctuation">}</span><span class="token punctuation">;</span></div></code-point></code-point><code-point step-initial="block-hidden" step-process=""><code-point step-process="active"><span class="token keyword">const</span> getLightColor <span class="token operator">=</span> <span class="token function">stateMachine</span><span class="token punctuation">(</span>trafficLight<span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><br><div><span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'traffic-light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div><span class="token keyword">const</span> <span class="token function-variable function">updateDOM</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>  el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token operator">...</span>possibleStates<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token punctuation">}</span><span class="token punctuation">;</span></div><br><div>el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><code-point step-process="active">  <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token function">getLightColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div>  <span class="token function">updateDOM</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code-point></code></pre></div></section><section class="centered" id="traffic-light-demo"><div id="traffic-light"><div></div><div></div><div></div></div></section><section is="app-story"><h2 id="rendering-machine">Suspend</h2><div class="scrollable"><app-story-point step="initial"><p>trafficLight(): no execution</p></app-story-point><app-story-point step="next-1"><p>First "next()"</p></app-story-point><app-story-point step="next-2"><p>Second next()</p></app-story-point><app-story-point step="next-3"><p>Third next()</p></app-story-point><app-story-point step="etc"><p>etc</p></app-story-point></div><div class="code-container"><pre><code class="language-javascript"><div><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">trafficLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><code-point step-initial="inline-hidden" step-next-1="active" step-next-2=""><div>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><code-point step-inital="" step-next-3="" step-etc="active"><div>    el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'green'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    <span class="token keyword">yield</span><span class="token punctuation">;</span></div></code-point></code-point><code-point step-initial="inline-hidden" step-next-2="active" step-next-3=""><div>    el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'green'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    <span class="token keyword">yield</span><span class="token punctuation">;</span></div></code-point><code-point step-initial="inline-hidden" step-next-3="active" step-etc=""><div>    el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    <span class="token keyword">yield</span><span class="token punctuation">;</span></div></code-point><code-point step-initial="inline-hidden" step-next-1="">  <span class="token punctuation">}</span></code-point><div><span class="token punctuation">}</span></div></code></pre></div></section><section is="app-story"><h2 id="yield-assignation">Yield and assignation</h2><div class="scrollable"><app-story-point step="initial"><p>Getting the state from outside</p></app-story-point><app-story-point step="next-arg"><p>Pass message/data to "next"</p></app-story-point><app-story-point step="first-call"><p>Watch out the first call</p></app-story-point><app-story-point step="co-wrapper"><p>coroutine wrapper</p></app-story-point><app-story-point step="dispatcher"><p>main "Actor" behaves as a dispatcher</p></app-story-point></div><div class="code-container"><pre><code class="language-javascript"><code-point step-initial="" step-next-arg="block-hidden"><div><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">renderingRoutine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token string">'initial'</span><span class="token punctuation">;</span></div><div>  <span class="token keyword">const</span> <span class="token punctuation">{</span> classList <span class="token punctuation">}</span> <span class="token operator">=</span> el<span class="token punctuation">;</span></div><div>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><code-point step-initial="active" step-next-arg="">    <span class="token keyword">const</span> newState <span class="token operator">=</span> <span class="token keyword">yield</span><span class="token punctuation">;</span></code-point><div>    classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newState<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    state <span class="token operator">=</span> newState<span class="token punctuation">;</span></div><div>  <span class="token punctuation">}</span></div><div><span class="token punctuation">}</span></div></code-point><code-point step-initial="block-hidden" step-next-arg="" step-dispatcher="block-hidden"><div><span class="token keyword">const</span> it <span class="token operator">=</span> <span class="token function">renderingRoutine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><code-point step-next-arg="inline-hidden" step-first-call="active" step-co-wrapper="">it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'green'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token comment">// etc</span></div><br><code-point step-initial="inline-hidden" step-co-wrapper=""><div><span class="token keyword">const</span> <span class="token function-variable function">coroutine</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">const</span> it <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><code-point step-next-arg="active">  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div><span class="token punctuation">}</span><span class="token punctuation">;</span></div></code-point></code-point><code-point step-initial="block-hidden" step-dispatcher=""><div><span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token function">coroutine</span><span class="token punctuation">(</span>renderingRoutine<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token keyword">const</span> <span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token function">getLightColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div>el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> dispatch<span class="token punctuation">)</span><span class="token punctuation">;</span></div></code-point></code></pre></div></section><section is="app-story"><h2 id="redux">Bidirectional</h2><div class="scrollable"><app-story-point step="initial"><p>both direction</p></app-story-point><app-story-point step="coroutine"><p>coroutine wrapper</p></app-story-point><app-story-point step="reducer"><p>reducer example</p></app-story-point><app-story-point step="dispatch"><p>dispatch action</p></app-story-point><app-story-point step="event-emitter"><p>Digression: create a subscription mechanism</p></app-story-point><app-story-point step="store"><p>create a "store"</p></app-story-point><app-story-point step="enjoy"><p>And enjoy !</p></app-story-point></div><div class="code-container"><pre><code class="language-javascript"><code-point step-initial="" step-reducer="block-hidden"><code-point step-initial="" step-coroutine="faded"><div><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">stateLoop</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> reducer<span class="token punctuation">,</span> initialState <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">let</span> state <span class="token operator">=</span> initialState<span class="token punctuation">;</span></div><div>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><code-point step-initial="active" step-coroutine="">    <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token keyword">yield</span> state<span class="token punctuation">;</span></code-point><div>    state <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  <span class="token punctuation">}</span></div><div><span class="token punctuation">}</span></div></code-point><br><code-point step-initial="inline-hidden" step-coroutine=""><div><span class="token keyword">const</span> coroutine <span class="token operator">=</span></div><div>  <span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token operator">=></span></div><div>  <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> reducer<span class="token punctuation">,</span> initialState <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>    <span class="token keyword">const</span> loop <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> reducer<span class="token punctuation">,</span> initialState <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    loop<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><code-point step-initial="active">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=></span> loop<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span></code-point><div>  <span class="token punctuation">}</span><span class="token punctuation">;</span></div></code-point></code-point><code-point step-initial="block-hidden" step-reducer="" step-dispatch="block-hidden"><div><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token operator">?.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>    <span class="token keyword">case</span> <span class="token string">'increment'</span><span class="token operator">:</span></div><div>      <span class="token keyword">return</span> <span class="token punctuation">{</span></div><div>        <span class="token operator">...</span>state<span class="token punctuation">,</span></div><div>        <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token punctuation">(</span>action<span class="token operator">?.</span>step <span class="token operator">??</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div>      <span class="token punctuation">}</span><span class="token punctuation">;</span></div><div>    <span class="token keyword">case</span> <span class="token string">'decrement'</span><span class="token operator">:</span></div><div>      <span class="token keyword">return</span> <span class="token punctuation">{</span></div><div>        <span class="token operator">...</span>state<span class="token punctuation">,</span></div><div>        <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token punctuation">(</span>action<span class="token operator">?.</span>step <span class="token operator">??</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div>      <span class="token punctuation">}</span><span class="token punctuation">;</span></div><div>  <span class="token punctuation">}</span></div><div>  <span class="token keyword">return</span> state<span class="token punctuation">;</span></div><div><span class="token punctuation">}</span><span class="token punctuation">;</span></div></code-point><code-point step-initial="block-hidden" step-dispatch="" step-event-emitter="block-hidden"><div><span class="token keyword">const</span> createDispatch <span class="token operator">=</span> <span class="token function">coroutine</span><span class="token punctuation">(</span>stateLoop<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">createDispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span></div><div>  reducer<span class="token punctuation">,</span></div><div>  <span class="token literal-property property">initialState</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></div><div><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'increment'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token comment">// { count: 1 }</span></div><div>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'increment'</span><span class="token punctuation">,</span> <span class="token literal-property property">step</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token comment">// { count: 4 }</span></div><div>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'decrement'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token comment">// { count: 3 }</span></div><div>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'increment'</span><span class="token punctuation">,</span> <span class="token literal-property property">step</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code-point><code-point step-initial="block-hidden" step-event-emitter="" step-store="block-hidden"><div><span class="token keyword">const</span> createSubscribable <span class="token operator">=</span> <span class="token punctuation">(</span>eventName <span class="token operator">=</span> <span class="token string">'state-changed'</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">const</span> eventTarget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div>  <span class="token keyword">const</span> <span class="token function-variable function">notify</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>    eventTarget<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span>eventName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  <span class="token punctuation">}</span><span class="token punctuation">;</span></div><div>  <span class="token keyword">const</span> <span class="token function-variable function">subscribe</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">listener</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>    eventTarget<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">unsubscribe</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  <span class="token punctuation">}</span><span class="token punctuation">;</span></div><div>  <span class="token keyword">const</span> <span class="token function-variable function">unsubscribe</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">listener</span><span class="token punctuation">)</span> <span class="token operator">=></span></div><div>    eventTarget<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div>  <span class="token keyword">return</span> <span class="token punctuation">{</span></div><div>    unsubscribe<span class="token punctuation">,</span></div><div>    subscribe<span class="token punctuation">,</span></div><div>    notify<span class="token punctuation">,</span></div><div>  <span class="token punctuation">}</span><span class="token punctuation">;</span></div><div><span class="token punctuation">}</span><span class="token punctuation">;</span></div></code-point><code-point step-initial="block-hidden" step-store="" step-enjoy="block-hidden"><div><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createStore</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reducer<span class="token punctuation">,</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">let</span> state <span class="token operator">=</span> initialState<span class="token punctuation">;</span></div><div>  <span class="token keyword">const</span> <span class="token punctuation">{</span> notify<span class="token punctuation">,</span> <span class="token operator">...</span>subscribable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createSubscribable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">createDispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> reducer<span class="token punctuation">,</span> initialState <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  <span class="token keyword">return</span> <span class="token punctuation">{</span></div><div>    <span class="token operator">...</span>subscribable<span class="token punctuation">,</span></div><div>    <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>      <span class="token keyword">return</span> <span class="token function">structuredClone</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    <span class="token punctuation">}</span><span class="token punctuation">,</span></div><div>    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>      state <span class="token operator">=</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>      <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    <span class="token punctuation">}</span><span class="token punctuation">,</span></div><div>  <span class="token punctuation">}</span><span class="token punctuation">;</span></div><div><span class="token punctuation">}</span><span class="token punctuation">;</span></div></code-point><code-point step-initial="block-hidden" step-enjoy=""><div><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span></div><div>  <span class="token literal-property property">initialState</span><span class="token operator">:</span> <span class="token punctuation">{</span></div><div>    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></div><div>  <span class="token punctuation">}</span><span class="token punctuation">,</span></div><div><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div>store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'increment'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token comment">// etc</span></div></code-point></code></pre></div></section><section is="app-story"><h2 id="custom-elements">Custom Elements</h2><div class="scrollable"><app-story-point step="extends"><p>Extends native HTML Elements</p></app-story-point><app-story-point step="reactive-attributes"><p>Define reactive attributes</p></app-story-point><app-story-point step="lifecycles"><p>Element lifecycles</p></app-story-point><app-story-point step="registry"><p>Element registry</p></app-story-point></div><div class="code-container"><pre><code class="language-javascript"><code-point step-extends="" step-registry="block-hidden"><code-point step-extends="" step-reactive-attributes="faded"><code-point step-extends="active" step-reactive-attributes=""><span class="token keyword">class</span> <span class="token class-name">MyElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLParagraphElement</span> <span class="token punctuation">{</span></code-point><br><div>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  <span class="token punctuation">}</span></div></code-point><br><code-point step-extends="inline-hidden" step-reactive-attributes="" step-lifecycles="faded"><div>  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">observedAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><code-point step-reactive-attributes="active" step-lifecycles="">    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'my-attr'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code-point><div>  <span class="token punctuation">}</span></div><br><div>  <span class="token function">attributeChangedCallback</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>    <span class="token comment">// update</span></div><div>  <span class="token punctuation">}</span></div><br></code-point><code-point step-extends="inline-hidden" step-lifecycles=""><div>  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>    <span class="token comment">// component mounted</span></div><div>  <span class="token punctuation">}</span></div><br><div>  <span class="token function">disconnectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>    <span class="token comment">// component unmounted</span></div><div>  <span class="token punctuation">}</span></div></code-point><code-point step-extends=""><span class="token punctuation">}</span></code-point><br></code-point><code-point step-extends="block-hidden" step-registry=""><div>customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'my-element'</span><span class="token punctuation">,</span> MyElement<span class="token punctuation">,</span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span></div><div><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div><span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;my-element my-attr="foo">Some text content&lt;/my-element></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></div></code-point></code></pre></div></section><section is="app-story"><h2 id="framework">Framework - basics</h2><div class="scrollable"><app-story-point step="initial"><p>From coroutine to custom element</p></app-story-point><app-story-point step="render-function"><p>"render" triggers the next tick</p></app-story-point><app-story-point step="registry"><p>custom "define"</p></app-story-point><app-story-point step="usage"><p>Use it</p></app-story-point><app-story-point step="observed-attributes"><p>Reactive attributes</p></app-story-point><app-story-point step="lifecycles"><p>Lifecycles</p></app-story-point></div><div class="code-container"><pre><code class="language-javascript"><code-point step-initial="" step-registry="block-hidden"><div><span class="token keyword">const</span> component <span class="token operator">=</span> <span class="token punctuation">(</span></div><code-point step-initial="active" step-render-function="">  renderLoop<span class="token punctuation">,</span></code-point><div>  <span class="token punctuation">{</span> Klass <span class="token operator">=</span> HTMLElement<span class="token punctuation">,</span> observedAttributes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></div><div><span class="token punctuation">)</span> <span class="token operator">=></span></div><div>  <span class="token keyword">class</span> <span class="token class-name">extends</span> Klass <span class="token punctuation">{</span></div><br><div>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><code-point step-initial="active" step-render-function=""><div>      <span class="token keyword">this</span><span class="token punctuation">.</span>_loop <span class="token operator">=</span> <span class="token function">renderLoop</span><span class="token punctuation">(</span><span class="token punctuation">{</span></div><div>        <span class="token literal-property property">$el</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span></div><div>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>      <span class="token keyword">this</span><span class="token punctuation">.</span>_loop<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code-point><code-point step-initial="inline-hidden" step-render-function="active"><div>      <span class="token keyword">this</span><span class="token punctuation">.</span>render <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code-point><div>    <span class="token punctuation">}</span></div><br><code-point step-initial="inline-hidden" step-render-function="active"><div>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">viewModel <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>      <span class="token keyword">this</span><span class="token punctuation">.</span>_loop<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span></div><div>        <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div>        <span class="token operator">...</span>viewModel<span class="token punctuation">,</span></div><div>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    <span class="token punctuation">}</span></div></code-point><br><div>  <span class="token punctuation">}</span><span class="token punctuation">;</span></div></code-point><code-point step-initial="block-hidden" step-registry="" step-usage="block-hidden"><div><span class="token keyword">const</span> <span class="token function-variable function">define</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> coroutine<span class="token punctuation">,</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>  customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span></div><div>    tag<span class="token punctuation">,</span></div><code-point step-registry="active"><div>    <span class="token function">component</span><span class="token punctuation">(</span>coroutine<span class="token punctuation">,</span> <span class="token punctuation">{</span></div><div>      <span class="token literal-property property">Klass</span><span class="token operator">:</span> classElementMap<span class="token punctuation">[</span>opts<span class="token operator">?.</span>extends<span class="token punctuation">]</span> <span class="token operator">??</span> HTMLElement<span class="token punctuation">,</span></div><div>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div></code-point><div>    opts</div><div>  <span class="token punctuation">)</span><span class="token punctuation">;</span></div><div><span class="token punctuation">}</span><span class="token punctuation">;</span></div><br></code-point><code-point step-initial="block-hidden" step-usage="" step-observed-attributes="block-hidden"><div><span class="token function">define</span><span class="token punctuation">(</span></div><div>  <span class="token string">'hello-world'</span><span class="token punctuation">,</span></div><code-point step-usage="active"><div>  <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">helloWorldComp</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> $el <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>        <span class="token keyword">const</span> viewModel <span class="token operator">=</span> <span class="token keyword">yield</span><span class="token punctuation">;</span></div><div>        $el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>viewModel<span class="token operator">?.</span>attributes<span class="token operator">?.</span>name <span class="token operator">??</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></div><div>      <span class="token punctuation">}</span></div><div>  <span class="token punctuation">}</span><span class="token punctuation">,</span></div></code-point><div>  <span class="token punctuation">{</span></div><div>    <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span></div><div>  <span class="token punctuation">}</span></div><div><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div><span class="token comment">// &lt;p is="hello-world" name="lyon-js">&lt;/p></span></div></code-point><code-point step-initial="block-hidden" step-observed-attributes="" step-lifecycles="block-hidden"><div><span class="token keyword">const</span> component <span class="token operator">=</span> <span class="token punctuation">(</span></div><div>  renderLoop<span class="token punctuation">,</span></div><code-point step-observed-attributes="active">  <span class="token punctuation">{</span> Klass <span class="token operator">=</span> HTMLElement<span class="token punctuation">,</span> observedAttributes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code-point><div><span class="token punctuation">)</span> <span class="token operator">=></span></div><div>  <span class="token keyword">class</span> <span class="token class-name">extends</span> Klass <span class="token punctuation">{</span></div><br><div>    <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">observedAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><code-point step-observed-attributes="active">      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>observedAttributes<span class="token punctuation">]</span><span class="token punctuation">;</span></code-point><div>    <span class="token punctuation">}</span></div><div>    <span class="token comment">// ...</span></div><br><div>    <span class="token function">attributeChangedCallback</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldValue <span class="token operator">!==</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><code-point step-observed-attributes="active">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div>      <span class="token punctuation">}</span></div><div>    <span class="token punctuation">}</span></div><br><div>  <span class="token punctuation">}</span><span class="token punctuation">;</span></div></code-point><code-point step-initial="block-hidden" step-lifecycles=""><div><span class="token keyword">const</span> component <span class="token operator">=</span> <span class="token punctuation">(</span></div><div>  renderLoop<span class="token punctuation">,</span></div><div>  <span class="token punctuation">{</span> Klass <span class="token operator">=</span> HTMLElement<span class="token punctuation">,</span> observedAttributes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></div><div><span class="token punctuation">)</span> <span class="token operator">=></span></div><div>  <span class="token keyword">class</span> <span class="token class-name">extends</span> Klass <span class="token punctuation">{</span></div><div>    <span class="token comment">// ...</span></div><br><div>    <span class="token function">disconnectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><code-point step-lifecycles="active">      <span class="token keyword">this</span><span class="token punctuation">.</span>_loop<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div>    <span class="token punctuation">}</span></div><div>  <span class="token punctuation">}</span><span class="token punctuation">;</span></div><br><div>    <span class="token comment">// ...</span></div><br><div>  <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">helloWorldComp</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> $el <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>    <span class="token keyword">try</span> <span class="token punctuation">{</span></div><div>      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>        <span class="token keyword">const</span> viewModel <span class="token operator">=</span> <span class="token keyword">yield</span><span class="token punctuation">;</span></div><div>        $el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>viewModel<span class="token operator">?.</span>attributes<span class="token operator">?.</span>name <span class="token operator">??</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></div><div>      <span class="token punctuation">}</span></div><div>    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></div><code-point step-lifecycles="active">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'removed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div>    <span class="token punctuation">}</span></div><div>  <span class="token punctuation">}</span><span class="token punctuation">,</span></div></code-point></code></pre></div></section><section class="centered" id="basic-demo"><p is="hello-world" name="Laurent"></p></section><section is="app-story"><h2 id="stateful">Stateful component</h2><div class="scrollable"><app-story-point step="initial"><p>Just use a local variable</p></app-story-point></div><div class="code-container"><pre><code class="language-javascript"><div><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">clickCountComponent</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> $el <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">textContent</span><span class="token operator">:</span> label <span class="token punctuation">}</span> <span class="token operator">=</span> $el<span class="token punctuation">;</span></div><code-point step-initial="active">  <span class="token keyword">let</span> clickCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code-point><br><div>  $el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><code-point step-initial="active">    clickCount<span class="token operator">++</span><span class="token punctuation">;</span></code-point><div>    $el<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>    <span class="token keyword">yield</span><span class="token punctuation">;</span></div><div>    $el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>label<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>clickCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></div><div>  <span class="token punctuation">}</span></div><div><span class="token punctuation">}</span></div></code></pre></div></section><section is="app-story"><h2 id="controller">Controllers</h2><div class="scrollable"><app-story-point step="injectables"><p>Use delegation to stack responsibilities</p></app-story-point><app-story-point step="upgrade-render"><p>Upgrade "render"</p></app-story-point><app-story-point step="connect"><P>Connect the component</P></app-story-point><app-story-point step="controller"><p>Draw the update logic into a container</p></app-story-point></div><div class="code-container"><pre><code class="language-javascript"><code-point step-injectables="" step-upgrade-render="block-hidden"><div><span class="token keyword">const</span> withInjectables <span class="token operator">=</span></div><div>  <span class="token punctuation">(</span><span class="token parameter">injectables <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span></div><div>  <span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token operator">=></span></div><div>    <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span>arg <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><code-point step-injectables="active">      <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">{</span></code-point><div>        <span class="token operator">...</span>injectables<span class="token punctuation">,</span></div><div>        <span class="token operator">...</span>arg<span class="token punctuation">,</span></div><div>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    <span class="token punctuation">}</span><span class="token punctuation">;</span></div><br><div><span class="token keyword">const</span> withStore <span class="token operator">=</span> <span class="token function">withInjectables</span><span class="token punctuation">(</span><span class="token punctuation">{</span> store <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div><span class="token function">define</span><span class="token punctuation">(</span></div><div>  <span class="token string">'foo-bar'</span><span class="token punctuation">,</span></div><div>  <span class="token function">withStore</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">CountDisplay</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> store <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>    <span class="token comment">/* store is injected */</span></div><div>  <span class="token punctuation">}</span><span class="token punctuation">)</span></div><div><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code-point><code-point step-injectables="block-hidden" step-upgrade-render="" step-controller="block-hidden"><div><span class="token keyword">const</span> <span class="token function-variable function">CountDisplay</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> store<span class="token punctuation">,</span> $el <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>  <span class="token keyword">const</span> <span class="token punctuation">{</span> render <span class="token punctuation">}</span> <span class="token operator">=</span> $el<span class="token punctuation">;</span></div><code-point step-upgrade-render="active" step-connect="">  $el<span class="token punctuation">.</span><span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arg <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></code-point><div>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span></div><code-point step-upgrade-render="active" step-connect="">      <span class="token literal-property property">state</span><span class="token operator">:</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code-point><div>      <span class="token operator">...</span>arg<span class="token punctuation">,</span></div><div>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>  <span class="token punctuation">}</span><span class="token punctuation">;</span></div><br><code-point step-injectables="inline-hidden" step-connect=""><code-point step-connect="active">  <span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>$el<span class="token punctuation">.</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><br><div>  <span class="token keyword">try</span> <span class="token punctuation">{</span></div><div>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><code-point step-connect="active">      <span class="token keyword">const</span> <span class="token punctuation">{</span> state <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">yield</span><span class="token punctuation">;</span></code-point><div>      $el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></div><div>    <span class="token punctuation">}</span></div><div>  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></div><code-point step-connect="active">    <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point><div>  <span class="token punctuation">}</span></div></code-point><div><span class="token punctuation">}</span><span class="token punctuation">;</span></div></code-point><code-point step-injectables="block-hidden" step-controller=""><div><span class="token keyword">const</span> <span class="token function-variable function">connectController</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">component</span><span class="token punctuation">)</span> <span class="token operator">=></span></div><div>  <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> $el<span class="token punctuation">,</span> store<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div>    <span class="token keyword">const</span> <span class="token punctuation">{</span> render <span class="token punctuation">}</span> <span class="token operator">=</span> $el<span class="token punctuation">;</span></div><div>    $el<span class="token punctuation">.</span><span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arg <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></div><div>      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span></div><div>        <span class="token operator">...</span>arg<span class="token punctuation">,</span></div><div>        <span class="token literal-property property">state</span><span class="token operator">:</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    <span class="token punctuation">}</span><span class="token punctuation">;</span></div><br><div>    <span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>$el<span class="token punctuation">.</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div>    <span class="token keyword">try</span> <span class="token punctuation">{</span></div><code-point step-controller="active">      <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">{</span></code-point><div>        $el<span class="token punctuation">,</span></div><div>        store<span class="token punctuation">,</span></div><div>        <span class="token operator">...</span>rest<span class="token punctuation">,</span></div><div>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></div><div>      <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div>    <span class="token punctuation">}</span></div><div>  <span class="token punctuation">}</span><span class="token punctuation">;</span></div><br><code-point step-controller="active"><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'foo-bar'</span><span class="token punctuation">,</span> <span class="token function">withStore</span><span class="token punctuation">(</span><span class="token function">connectController</span><span class="token punctuation">(</span>CountDisplay<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code-point></code-point></code></pre></div></section><section class="centered" id="controller-demo"><div id="counter"><button is="action-button" action="increment">increment</button><app-counter>0</app-counter><button is="action-button" action="decrement">decrement</button></div></section></main></body></html>